<!-- eslint-disable @angular-eslint/template/cyclomatic-complexity -->
<div [style.background]="globalSettings.bgColor">
    <form class="global-settings vertical">
        <div class="setting-group horizontal gap">
            @if (!globalSettings.horizontal) {
                <button class="button icon-button" (click)="toggleLayout()">
                    <i class="fa-solid fa-grip"></i>
                </button>
            } @else {
                <button class="button icon-button" (click)="toggleLayout()">
                    <i class="fa-solid fa-grip-vertical"></i>
                </button>
            }
            @if (globalSettings.expanded) {
                <button class="button icon-button" (click)="toggleExpanded()">
                    <i class="fa-solid fa-compress"></i>
                </button>
            } @else {
                <button class="button icon-button" (click)="toggleExpanded()">
                    <i class="fa-solid fa-expand"></i>
                </button>
            }
            @if (!globalSettings.logo) {
                <button class="button" (click)="toggleLogoMode()">Title</button>
            } @else {
                <button class="button" (click)="toggleLogoMode()">Text</button>
            }
        </div>

        <div class="setting-group">
            <div class="horizontal setting">
                <input
                    type="color"
                    name="colorPicker"
                    [ngModelOptions]="{standalone: true}"
                    [(ngModel)]="globalSettings.textColor"
                    (change)="persist()"
                />
                <button class="icon-button swap-colors-button" (click)="swapColors()">
                    <i class="fa-solid fa-rotate"></i>
                </button>
                <input
                    type="color"
                    name="bgPicker"
                    [ngModelOptions]="{standalone: true}"
                    [(ngModel)]="globalSettings.bgColor"
                    (change)="fixContrast('AA'); persist()"
                />
                <button
                    class="icon-button swap-colors-button contrast-button"
                    [class.alert]="!matchContrast('AAA')"
                    [class.error]="!matchContrast('AA')"
                    (click)="fixContrast('AAA')"
                >
                    <i class="fa-solid fa-circle-half-stroke"></i>
                </button>
            </div>

            <app-font-settings
                [model]="globalSettings"
                (change)="autoresize()"
                (resetFired)="resetGlobalFontSettings()"
            />

            <div class="horizontal gap">
                <label class="checkbox">
                    <input
                        type="checkbox"
                        [value]="1"
                        [ngModelOptions]="{standalone: true}"
                        [(ngModel)]="globalSettings.italic"
                        (ngModelChange)="persist()"
                    />
                    <span class="icon-button"><i class="fa-solid fa-italic"></i></span>
                </label>

                @if (globalSettings.fontVariant === 'all-small-caps') {
                    <button class="icon-button active" (click)="globalSettings.fontVariant = 'normal'; persist()">
                        <i class="fa-solid fa-a small"></i>
                    </button>
                }
                @if (globalSettings.fontVariant === 'normal') {
                    <button class="icon-button" (click)="globalSettings.fontVariant = 'small-caps'; persist()">
                        <i class="fa-solid fa-a"></i>
                    </button>
                }
                @if (globalSettings.fontVariant === 'small-caps') {
                    <button
                        class="icon-button active"
                        (click)="globalSettings.fontVariant = 'all-small-caps'; persist()"
                    >
                        <i class="fa-solid fa-a"></i>
                    </button>
                }
                @if (!globalSettings.logo) {
                    @if (globalSettings.align === 'left') {
                        <button class="icon-button" (click)="globalSettings.align = 'center'; persist()">
                            <i class="fa-solid fa-align-left"></i>
                        </button>
                    }
                    @if (globalSettings.align === 'center') {
                        <button class="icon-button active" (click)="globalSettings.align = 'right'; persist()">
                            <i class="fa-solid fa-align-center"></i>
                        </button>
                    }
                    @if (globalSettings.align === 'right') {
                        <button class="icon-button active" (click)="globalSettings.align = 'justify'; persist()">
                            <i class="fa-solid fa-align-right"></i>
                        </button>
                    }
                    @if (globalSettings.align === 'justify') {
                        <button class="icon-button active" (click)="globalSettings.align = 'left'; persist()">
                            <i class="fa-solid fa-align-justify"></i>
                        </button>
                    }
                }
            </div>

            <br />
            <div class="inline-listing">
                @for (category of categories; track category) {
                    <label class="category checkbox">
                        <input
                            type="checkbox"
                            [value]="category"
                            [ngModelOptions]="{standalone: true}"
                            [(ngModel)]="selectedCategories[category]"
                            (change)="filterFonts()"
                        />
                        <span class="button">{{ category }}</span>
                    </label>
                }
            </div>

            <br />
            <div class="horizontal">
                <label class="checkbox" style="margin-bottom: 4px">
                    <input
                        type="checkbox"
                        [value]="1"
                        [ngModelOptions]="{standalone: true}"
                        [(ngModel)]="globalSettings.allVariants"
                        (change)="filterFonts()"
                    />
                    @if (!globalSettings.allVariants) {
                        <span>Or :</span>
                    } @else {
                        <span>And :</span>
                    }
                </label>
                <div class="spacer"></div>
                <strong>{{ fonts.length }} fonts</strong>
            </div>

            <div class="inline-listing">
                @for (variant of variants; track variant) {
                    <label class="variant checkbox">
                        <input
                            type="checkbox"
                            [value]="variant"
                            [ngModelOptions]="{standalone: true}"
                            [(ngModel)]="selectedVariants[variant]"
                            (change)="filterFonts()"
                        />
                        <span class="button">{{ variant }}</span>
                    </label>
                }
            </div>

            <br />
            <strong>Default title font</strong>
            <app-font-select
                label="Inherits body"
                [font]="globalSettings.titleFont"
                [fonts]="fonts"
                [showClear]="true"
                (selectionChange)="globalSettings.titleFont = $event?.selected || null; useFont($event)"
            />
        </div>

        <div class="github">
            <a href="https://sambaptista.github.io/font-comparator/"><i class="fa-brands fa-github"></i></a>
        </div>
    </form>

    <div
        #modelsWrapper
        class="models"
        cdkDropList
        [style.color]="globalSettings.textColor"
        [class.horizontal-layout]="globalSettings.horizontal"
        [class.vertical-layout]="!globalSettings.horizontal"
        [class.expanded]="globalSettings.expanded"
        [class.collapsed]="!globalSettings.expanded"
        [class.mode-logo]="globalSettings.logo"
        (cdkDropListDropped)="drop($event)"
    >
        @for (model of models; track model) {
            <form #modelElement cdkDrag class="model" [style.fontSize.px]="getFontSetting(model, 'fontSize')">
                <div class="model-tools vertical gap" >
                    <app-font-select
                        label="Title inherits body"
                        [font]="model.titleFont"
                        [fonts]="fonts"
                        [showClear]="true"
                        (selectionChange)="model.titleFont = $event?.selected || null; useFont($event)"
                    />
                    <app-font-select
                        label="Body font"
                        [font]="model.bodyFont"
                        [fonts]="fonts"
                        (selectionChange)="model.bodyFont = $event?.selected || null; useFont($event)"
                    />

                    <div class="gap horizontal">
                        <button class="button" (click)="duplicate(model)"><i class="fa-solid fa-copy"></i></button>
                        <button class="button warn" (click)="remove($index)"><i class="fa-solid fa-trash"></i></button>

                        @if (model && model.bodyFont) {
                            <a
                                class="button"
                                target="_blank"
                                [attr.href]="`https://fonts.google.com/specimen/${model.bodyFont.family}`"
                                ><i class="fa-solid fa-link"></i
                            ></a>
                        }

                        <button class="button" cdkDragHandle><i class="fa-solid fa-up-down-left-right"></i></button>
                        <div class="spacer"></div>
                        @if (model.bodyFont?.variants?.length) {
                            {{ model.bodyFont?.variants?.length }} variants
                        }
                    </div>

                    <app-font-settings
                        [model]="model"
                        (selectionChange)="autoresize()"
                        (resetFired)="resetFontSettings(model)"
                    />
                </div>

                @if (model.bodyFont) {
                    <div
                        class="model-body"
                        [style.fontVariant]="globalSettings.fontVariant"
                        [style.textAlign]="globalSettings.align"
                        [style.fontStyle]="globalSettings.italic ? 'italic' : 'normal'"
                        [style.lineHeight.em]="getFontSetting(model, 'lineHeight')"
                        [style.fontWeight]="getFontSetting(model, 'fontWeight')"
                        [style.wordSpacing.em]="getFontSetting(model, 'wordSpacing')"
                        [style.letterSpacing.em]="getFontSetting(model, 'letterSpacing')"
                    >
                        <input
                            class="title"
                            [ngModelOptions]="{standalone: true}"
                            [style.fontFamily]="
                                model.titleFont?.family || globalSettings.titleFont?.family || model.bodyFont.family
                            "
                            [(ngModel)]="titleText"
                            (change)="autoresize()"
                        />
                        @if (!globalSettings.logo) {
                            <textarea
                                #autosize="cdkTextareaAutosize"
                                class="body"
                                cdkTextareaAutosize
                                [style.fontFamily]="model.bodyFont.family"
                                [ngModelOptions]="{standalone: true}"
                                [(ngModel)]="bodyText"
                                (change)="autoresize()"
                            ></textarea>
                        }
                    </div>
                }
            </form>
        }
    </div>

    <button
        class="icon-button fab"
        [style.background]="globalSettings.textColor"
        [style.color]="globalSettings.bgColor"
        (click)="addModel()"
    >
        <i class="fa-solid fa-add"></i>
    </button>

    <router-outlet />
</div>
